<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Time Zone Converter</title>
<meta name="description" content="Dual-slider time zone converter for sales teams">
<style>
  :root{
    --bg:#f8fafc; --card:#fff; --border:#0f172a; --text:#0f172a; --muted:#64748b;
    --ring:#bae6fd; --orange:#f97316; --blue:#2563eb;
  }
  *{box-sizing:border-box} html,body{height:100%;margin:0}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans,"Apple Color Emoji","Segoe UI Emoji";
       background:linear-gradient(#fff,var(--bg));color:var(--text)}
  /* Thick orange border around whole app */
  .container{
    max-width:1000px;margin:32px auto;padding:24px;background:var(--card);
    border:6px solid var(--orange); border-radius:16px;
    box-shadow:0 6px 24px rgba(2,6,23,.08)
  }
  .header{display:flex;align-items:center;justify-content:space-between;gap:16px}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{height:40px;width:auto}
  h1{margin:8px 0 0;font-size:26px}

  /* Summary section gets bold blue border (thinner than orange) */
  .summary{
    border:3px solid var(--blue); border-radius:12px; padding:20px;
    display:grid; grid-template-columns:1fr 2fr; gap:16px; background:#fff
  }
  @media(max-width:800px){.summary{grid-template-columns:1fr}}

  .muted{color:var(--muted);font-size:14px}
  .big{font-size:28px;font-weight:700}

  /* Two-column cards with bold outlines */
  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:16px}
  @media(max-width:800px){.grid2{grid-template-columns:1fr}}
  .card{
    background:#fff; border:3px solid var(--border); border-radius:12px; padding:16px
  }
  .label{ text-transform:uppercase; letter-spacing:.06em; color:var(--muted); font-size:12px; margin-bottom:8px }
  .time{ font-size:22px; font-weight:700 }
  .badge{ margin-left:8px; font-size:12px; background:#f1f5f9; color:#334155; padding:2px 8px; border-radius:999px }

  /* Combobox with bold outline */
  .combo{ position:relative }
  .search{
    display:flex; align-items:center; gap:8px;
    border:2px solid var(--border); padding:10px 12px; border-radius:10px; background:#fff
  }
  .search input{ border:none; outline:none; width:100%; font-size:14px }
  .listbox{
    position:absolute; top:calc(100% + 6px); left:0; right:0; max-height:280px; overflow:auto;
    background:#fff; border:2px solid var(--border); border-radius:10px;
    box-shadow:0 12px 32px rgba(2,6,23,.12); z-index:40
  }
  .option{ width:100%; text-align:left; padding:10px 12px; font-size:14px; cursor:pointer; background:#fff; border:none }
  .option:hover,.option.active{ background:#f8fafc }

  /* Sliders */
  .range{ width:100% }

  /* Buttons */
  .btn, .toggle{
    border:2px solid var(--border); background:#fff; border-radius:10px; padding:8px 12px; font-size:14px; cursor:pointer; font-weight:600
  }
  .btn:focus, .toggle:focus{ outline:3px solid var(--ring) }
  .toggle.active{ background:#0ea5e9; border-color:#0ea5e9; color:#fff }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <img src="./logo.png" alt="Recast Software" onerror="this.style.display='none'">
        <h1>Time Zone Converter</h1>
      </div>
    </div>

    <div class="summary" style="margin-top:16px">
      <div>
        <div class="muted">Current difference</div>
        <div id="diff" class="big">0 hrs</div>
        <div class="muted" style="margin-top:8px">
          Drag the Rep slider; Prospect updates instantly. Use Swap to flip roles.
        </div>
        <div style="margin-top:12px">
          <button id="swap" class="btn">Swap</button>
        </div>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="label">Rep's Timezone</div>
          <div class="combo" id="rep-combo"></div>
          <div style="margin-top:12px;display:flex;align-items:center;justify-content:space-between">
            <div class="time"><span id="rep-time">--:--</span></div>
          </div>
          <div style="margin-top:10px">
            <input id="rep-range" class="range" type="range" min="0" max="1439" step="15">
          </div>
        </div>

        <div class="card">
          <div class="label">Prospect's Timezone</div>
          <div class="combo" id="prospect-combo"></div>
          <div style="margin-top:12px;display:flex;align-items:center;justify-content:space-between; gap:12px">
            <div class="time"><span id="prospect-time">--:--</span></div>
            <button id="mil-toggle" class="toggle" aria-pressed="false" title="Toggle military (24-hour) time for Prospect">Military time</button>
          </div>
          <div style="margin-top:10px">
            <input id="prospect-range" class="range" type="range" min="0" max="1439" step="15" disabled>
          </div>
          <div style="margin-top:10px">
            <span id="badge" class="badge" style="display:none"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick set removed as requested -->
  </div>

<script>
(() => {
  // ----- Core time utils (DST-safe via Intl) -----
  const BASE_DATE = new Date();
  const clamp = n => ((n % 1440) + 1440) % 1440;
  const pad = n => String(n).padStart(2,'0');

  function parts(d, tz){
    const dtf = new Intl.DateTimeFormat('en-US',{
      timeZone: tz, year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false
    });
    const m = Object.fromEntries(dtf.formatToParts(d).map(p=>[p.type,p.value]));
    return {year:+m.year, month:+m.month, day:+m.day, hour:+m.hour, minute:+m.minute, second:+m.second};
  }
  function offsetMin(tz, d){
    const p = parts(d, tz);
    const asUTC = Date.UTC(p.year,p.month-1,p.day,p.hour,p.minute,p.second);
    return (asUTC - d.getTime())/60000;
  }
  function localToUTC({year,month,day,hour,minute}, tz){
    let guess = Date.UTC(year,month-1,day,hour,minute,0);
    let o = offsetMin(tz, new Date(guess));
    let utc = guess - o*60000;
    o = offsetMin(tz, new Date(utc));
    return new Date(Date.UTC(year,month-1,day,hour,minute,0) - o*60000);
  }
  function convert(mins, fromTz, toTz){
    const fp = parts(BASE_DATE, fromTz);
    const h = Math.floor(mins/60), m = mins%60;
    const utc = localToUTC({year:fp.year,month:fp.month,day:fp.day,hour:h,minute:m}, fromTz);
    const tp = parts(utc, toTz);
    const target = tp.hour*60 + tp.minute;
    const fromMidUTC = localToUTC({year:fp.year,month:fp.month,day:fp.day,hour:0,minute:0}, fromTz);
    const toAtFromMid = parts(fromMidUTC, toTz);
    const dayOff = Math.round(
      (Date.UTC(tp.year,tp.month-1,tp.day) - Date.UTC(toAtFromMid.year,toAtFromMid.month-1,toAtFromMid.day))/(24*3600*1000)
    );
    return { minutes: clamp(target), dayOff };
  }

  // ----- Zones & hints -----
  const ALL_TZ = (Intl.supportedValuesOf && Intl.supportedValuesOf('timeZone')) || [
    'America/Los_Angeles','America/Denver','America/Chicago','America/New_York',
    'Europe/London','Europe/Berlin','Europe/Paris','Asia/Kolkata','Asia/Shanghai','Asia/Tokyo','Australia/Sydney'
  ];
  const HINTS = new Map([
    ['usa',['America/New_York','America/Chicago','America/Denver','America/Los_Angeles','America/Phoenix','America/Anchorage','Pacific/Honolulu']],
    ['united states',['America/New_York','America/Chicago','America/Denver','America/Los_Angeles','America/Phoenix','America/Anchorage','Pacific/Honolulu']],
    ['uk',['Europe/London']], ['united kingdom',['Europe/London']],
    ['india',['Asia/Kolkata']], ['china',['Asia/Shanghai']], ['japan',['Asia/Tokyo']],
    ['australia',['Australia/Sydney','Australia/Brisbane','Australia/Adelaide','Australia/Perth','Australia/Darwin','Australia/Melbourne']],
    ['canada',['America/Toronto','America/Winnipeg','America/Edmonton','America/Vancouver','America/Halifax','America/St_Johns']],
  ]);

  // ----- Formatting: Rep always 12h; Prospect 12h unless military toggle -----
  function toLabel12(mins){
    const h = Math.floor(mins/60), m = mins%60;
    const p = h>=12 ? 'PM' : 'AM';
    const h12 = ((h+11)%12)+1;
    return `${h12}:${pad(m)} ${p}`;
  }
  function toLabel24(mins){
    const h = Math.floor(mins/60), m = mins%60;
    return `${pad(h)}:${pad(m)}`;
  }

  // ----- Combobox (vanilla) -----
  function makeCombo(rootId, initialTz, onChange){
    const root = document.getElementById(rootId);
    root.innerHTML = `
      <div class="search">
        <input type="text" placeholder="Input Country" aria-label="Search timezone">
        <div class="muted current"></div>
      </div>
      <div class="listbox" style="display:none"></div>
    `;
    const input = root.querySelector('input');
    const current = root.querySelector('.current');
    const list = root.querySelector('.listbox');

    let value = initialTz;
    current.textContent = fmtLabel(value);

    function fmtLabel(tz){
      const p = tz.split('/'); return `${p[0]} â€” ${p.slice(1).join('/').replaceAll('_',' ')} (${tz})`;
    }
    function computeList(q){
      const s = q.trim().toLowerCase();
      let base = ALL_TZ.slice();
      if (s && HINTS.has(s)){
        const set = new Set(HINTS.get(s));
        const hinted = base.filter(tz => set.has(tz));
        const rest = base.filter(tz => !set.has(tz));
        base = hinted.concat(rest);
      }
      const filtered = s
        ? base.filter(tz => tz.toLowerCase().includes(s) || fmtLabel(tz).toLowerCase().includes(s))
        : base;
      return filtered.slice(0, 300);
    }
    function open(){
      const q = input.value;
      const rows = computeList(q);
      list.innerHTML = rows.map((tz,i)=>`<button class="option" data-idx="${i}" data-tz="${tz}">${fmtLabel(tz)}</button>`).join('') ||
                       `<div class="muted" style="padding:10px 12px">No matches.</div>`;
      list.style.display = 'block';
    }
    function close(){ list.style.display = 'none'; }

    root.addEventListener('click', e => e.stopPropagation());
    document.addEventListener('click', () => close());

    input.addEventListener('focus', open);
    input.addEventListener('input', open);
    list.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-tz]');
      if (!btn) return;
      value = btn.dataset.tz;
      current.textContent = fmtLabel(value);
      input.value = '';
      close();
      onChange(value);
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') close();
      if (e.key === 'Enter') {
        const first = list.querySelector('[data-tz]');
        if (first) first.click();
      }
    });

    return {
      get value(){ return value; },
      set value(v){ value=v; current.textContent = fmtLabel(v); onChange(v); }
    };
  }

  // ----- Wire up UI -----
  const repRange = document.getElementById('rep-range');
  const prospectRange = document.getElementById('prospect-range');
  const repTime = document.getElementById('rep-time');
  const prospectTime = document.getElementById('prospect-time');
  const badge = document.getElementById('badge');
  const diff = document.getElementById('diff');
  const swap = document.getElementById('swap');
  const milToggle = document.getElementById('mil-toggle');

  const repCombo = makeCombo('rep-combo', 'America/Chicago', tz => update({repTz: tz}));
  const prospectCombo = makeCombo('prospect-combo', 'Europe/London', tz => update({prospectTz: tz}));

  let state = {
    repTz: repCombo.value,
    prospectTz: prospectCombo.value,
    repMins: 9*60,
    prospectMins: convert(9*60, repCombo.value, prospectCombo.value).minutes,
    prospectMilitary: false
  };
  repRange.value = state.repMins;
  prospectRange.value = state.prospectMins;

  function formatRep(m){ return toLabel12(m); }
  function formatProspect(m){ return state.prospectMilitary ? toLabel24(m) : toLabel12(m); }

  function update(patch = {}){
    state = {...state, ...patch};
    const conv = convert(state.repMins, state.repTz, state.prospectTz);
    state.prospectMins = conv.minutes;

    repTime.textContent = formatRep(state.repMins);
    prospectTime.textContent = formatProspect(state.prospectMins);

    if (conv.dayOff !== 0){
      badge.style.display = 'inline-block';
      badge.textContent = (conv.dayOff > 0 ? '+' : '') + conv.dayOff + ' day';
    } else {
      badge.style.display = 'none';
    }

    repRange.value = state.repMins;
    prospectRange.value = state.prospectMins;

    let d = (state.prospectMins - state.repMins)/60;
    d = Math.round(d*100)/100;
    if (d > 12) d -= 24;
    if (d < -12) d += 24;
    diff.textContent = (d>0?'+':'') + d + ' hrs';
  }

  repRange.addEventListener('input', e => update({repMins: +e.target.value}));
  swap.addEventListener('click', () => {
    const a = state.repTz, b = state.prospectTz;
    const am = state.repMins, bm = state.prospectMins;
    repCombo.value = b;
    prospectCombo.value = a;
    update({repTz: b, prospectTz: a, repMins: bm});
  });
  milToggle.addEventListener('click', () => {
    state.prospectMilitary = !state.prospectMilitary;
    milToggle.classList.toggle('active', state.prospectMilitary);
    milToggle.setAttribute('aria-pressed', String(state.prospectMilitary));
    update({});
  });

  update({});
})();
</script>
</body>
</html>
