<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Time Zone Converter</title>
<meta name="description" content="Dual-slider time zone converter for sales teams" />
<style>
  :root{--bg:#f8fafc;--card:#fff;--border:#0f172a;--text:#0f172a;--muted:#64748b;--ring:#bae6fd;--orange:#f97316;--blue:#2563eb}
  *{box-sizing:border-box} html,body{height:100%;margin:0}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans,"Apple Color Emoji","Segoe UI Emoji";
       background:linear-gradient(#fff,var(--bg));color:var(--text)}
  .container{max-width:1200px;margin:40px auto;padding:28px;background:var(--card);
             border:6px solid var(--orange);border-radius:18px;box-shadow:0 8px 28px rgba(2,6,23,.08)}
  .header{display:flex;align-items:center;gap:14px}
  .brand img{height:46px;width:auto}
  h1{margin:8px 0 0;font-size:30px}

  .summary{border:3px solid var(--blue);border-radius:14px;padding:22px;
           display:grid;grid-template-columns:1.1fr 2fr;gap:18px;background:#fff}
  @media(max-width:980px){.summary{grid-template-columns:1fr}}
  .muted{color:var(--muted);font-size:15px;line-height:1.35}
  .big{font-size:32px;font-weight:800}

  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:18px;align-items:stretch}
  @media(max-width:980px){.grid2{grid-template-columns:1fr}}
  .card{background:#fff;border:3px solid var(--border);border-radius:14px;padding:18px;display:flex}
  .card-grid{display:grid;grid-template-rows:auto auto auto auto;gap:14px;width:100%}

  .label{text-transform:uppercase;letter-spacing:.06em;color:#64748b;font-size:12px}
  .time-row{display:flex;align-items:center;gap:12px}
  .time{font-size:24px;font-weight:800;white-space:nowrap;margin-right:auto}
  .badge{font-size:12px;background:#f1f5f9;color:#334155;padding:2px 8px;border-radius:999px}

  .select,.search{border:2px solid var(--border);padding:12px 14px;border-radius:12px;background:#fff;width:100%;font-size:15px}
  .select{height:48px}
  .combo{position:relative}
  .search input{border:none;outline:none;width:100%;font-size:15px}
  .selected{margin-top:8px;font-size:15px;color:#334155;line-height:1.35;word-break:break-word;display:none}
  .listbox{position:absolute;top:calc(100% + 6px);left:0;right:0;max-height:300px;overflow:auto;background:#fff;border:2px solid var(--border);
           border-radius:12px;box-shadow:0 14px 34px rgba(2,6,23,.12);z-index:40}
  .option{width:100%;text-align:left;padding:10px 14px;font-size:15px;cursor:pointer;background:#fff;border:none}
  .option:hover,.option.active{background:#f8fafc}

  .slider-row{display:flex;align-items:center;gap:12px}
  .range{width:100%}

  .toggle{border:2px solid var(--border);background:#fff;border-radius:12px;padding:9px 14px;font-size:14px;cursor:pointer;font-weight:700}
  .toggle:disabled{opacity:.45;cursor:not-allowed}
  .toggle:focus{outline:3px solid var(--ring)}
  .toggle.active{background:#0ea5e9;border-color:#0ea5e9;color:#fff}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="./logo.png" alt="Recast Software" onerror="this.style.display='none'">
      <h1>Time Zone Converter</h1>
    </div>

    <div class="summary" style="margin-top:18px">
      <div>
        <div class="muted">Current difference</div>
        <div id="diff" class="big">—</div>
        <div class="muted" style="margin-top:8px">Drag the Rep slider; Prospect updates instantly.</div>
      </div>

      <div class="grid2">
        <!-- Rep -->
        <div class="card">
          <div class="card-grid">
            <div class="label">Rep’s Timezone</div>
            <select id="rep-select" class="select" aria-label="Select timezone">
              <option value="America/Los_Angeles">Pacific</option>
              <option value="America/Denver">Mountain</option>
              <option value="America/Chicago" selected>Central</option>
              <option value="America/New_York">Eastern</option>
            </select>
            <div class="time-row"><span id="rep-time" class="time">--:--</span></div>
            <div class="slider-row"><input id="rep-range" class="range" type="range" min="0" max="1439" step="15"></div>
          </div>
        </div>

        <!-- Prospect -->
        <div class="card">
          <div class="card-grid">
            <div class="label">Prospect’s Timezone</div>
            <div class="combo">
              <div class="search"><input id="prospect-input" type="text" placeholder="Type Country Name (or city/zone)" aria-label="Type to search country or time zone"></div>
              <div id="prospect-selected" class="selected"></div>
              <div id="prospect-list" class="listbox" style="display:none"></div>
            </div>
            <div class="time-row">
              <span id="prospect-time" class="time">--:--</span>
              <button id="mil-toggle" class="toggle" aria-pressed="false" disabled>Military time</button>
              <span id="badge" class="badge" style="display:none"></span>
            </div>
            <div class="slider-row"><input id="prospect-range" class="range" type="range" min="0" max="1439" step="15" disabled></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // ===== Time helpers (DST-safe) =====
  const BASE_DATE = new Date();
  const pad = n => String(n).padStart(2,'0');
  const clamp = n => ((n % 1440) + 1440) % 1440;

  function parts(d, tz){
    const dtf = new Intl.DateTimeFormat('en-US',{
      timeZone: tz, year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false
    });
    const m = Object.fromEntries(dtf.formatToParts(d).map(p=>[p.type,p.value]));
    return {year:+m.year, month:+m.month, day:+m.day, hour:+m.hour, minute:+m.minute, second:+m.second};
  }
  function offsetMin(tz, d){
    const p = parts(d, tz);
    const asUTC = Date.UTC(p.year,p.month-1,p.day,p.hour,p.minute,p.second);
    return (asUTC - d.getTime())/60000;
  }
  function localToUTC({year,month,day,hour,minute}, tz){
    let guess = Date.UTC(year,month-1,day,hour,minute,0);
    let o = offsetMin(tz, new Date(guess));
    let utc = guess - o*60000;
    o = offsetMin(tz, new Date(utc));
    return new Date(Date.UTC(year,month-1,day,hour,minute,0) - o*60000);
  }
  function convert(mins, fromTz, toTz){
    const fp = parts(BASE_DATE, fromTz);
    const h = Math.floor(mins/60), m = mins%60;
    const utc = localToUTC({year:fp.year,month:fp.month,day:fp.day,hour:h,minute:m}, fromTz);
    const tp = parts(utc, toTz);
    const target = tp.hour*60 + tp.minute;
    const fromMidUTC = localToUTC({year:fp.year,month:fp.month,day:fp.day,hour:0,minute:0}, fromTz);
    const toAtFromMid = parts(fromMidUTC, toTz);
    const dayOff = Math.round(
      (Date.UTC(tp.year,tp.month-1,tp.day) - Date.UTC(toAtFromMid.year,toAtFromMid.month-1,toAtFromMid.day)) / (24*3600*1000)
    );
    return {minutes: clamp(target), dayOff};
  }

  const toLabel12 = mins => {
    const h = Math.floor(mins/60), m = mins%60, p = h>=12 ? 'PM' : 'AM', h12 = ((h+11)%12)+1;
    return `${h12}:${pad(m)} ${p}`;
  };
  const toLabel24 = mins => `${pad(Math.floor(mins/60))}:${pad(mins%60)}`;
  const labelTZ = tz => { const p = tz.split('/'); return `${p[0]} — ${p.slice(1).join('/').replaceAll('_',' ')} (${tz})`; };

  // ===== Data: country -> primary zone (broad) =====
  const COUNTRY_TZ = new Map([
    ['Romania','Europe/Bucharest'], ['Italy','Europe/Rome'], ['United Kingdom','Europe/London'],
    ['France','Europe/Paris'], ['Germany','Europe/Berlin'], ['Spain','Europe/Madrid'], ['Portugal','Europe/Lisbon'],
    ['Ireland','Europe/Dublin'], ['Poland','Europe/Warsaw'], ['Greece','Europe/Athens'], ['Netherlands','Europe/Amsterdam'],
    ['Belgium','Europe/Brussels'], ['Sweden','Europe/Stockholm'], ['Norway','Europe/Oslo'], ['Finland','Europe/Helsinki'],
    ['Denmark','Europe/Copenhagen'], ['Switzerland','Europe/Zurich'], ['Austria','Europe/Vienna'], ['Czech Republic','Europe/Prague'],
    ['Hungary','Europe/Budapest'], ['Ukraine','Europe/Kyiv'], ['Turkey','Europe/Istanbul'],
    ['United States','America/New_York'], ['Canada','America/Toronto'], ['Mexico','America/Mexico_City'],
    ['Brazil','America/Sao_Paulo'], ['Argentina','America/Argentina/Buenos_Aires'], ['Chile','America/Santiago'],
    ['Colombia','America/Bogota'], ['Peru','America/Lima'],
    ['South Africa','Africa/Johannesburg'], ['Egypt','Africa/Cairo'], ['Nigeria','Africa/Lagos'], ['Kenya','Africa/Nairobi'],
    ['India','Asia/Kolkata'], ['China','Asia/Shanghai'], ['Japan','Asia/Tokyo'], ['South Korea','Asia/Seoul'],
    ['Singapore','Asia/Singapore'], ['Hong Kong','Asia/Hong_Kong'], ['Taiwan','Asia/Taipei'], ['Thailand','Asia/Bangkok'],
    ['United Arab Emirates','Asia/Dubai'], ['Israel','Asia/Jerusalem'], ['Saudi Arabia','Asia/Riyadh'],
    ['Australia','Australia/Sydney'], ['New Zealand','Pacific/Auckland']
  ]);

  // Build search sources:
  const ALL_TZ = (Intl.supportedValuesOf && Intl.supportedValuesOf('timeZone')) ? Intl.supportedValuesOf('timeZone') : [
    'Europe/London','Europe/Bucharest','Europe/Rome','America/New_York'
  ];
  const COUNTRY_ROWS = Array.from(COUNTRY_TZ.entries()).map(([c,tz]) => ({
    key:`country:${c}`, label:`${c} — ${labelTZ(tz)}`, tz
  }));
  const ZONE_ROWS = ALL_TZ.map(tz => ({key:`zone:${tz}`, label:labelTZ(tz), tz}));

  // ===== Elements =====
  const repSelect = document.getElementById('rep-select');
  const repRange  = document.getElementById('rep-range');
  const repTime   = document.getElementById('rep-time');

  const prospectInput    = document.getElementById('prospect-input');
  const prospectList     = document.getElementById('prospect-list');
  const prospectSelected = document.getElementById('prospect-selected');

  const prospectRange = document.getElementById('prospect-range');
  const prospectTime  = document.getElementById('prospect-time');
  const milToggle     = document.getElementById('mil-toggle');
  const badge         = document.getElementById('badge');
  const diff          = document.getElementById('diff');

  // ===== State =====
  let state = {
    repTz: repSelect.value || 'America/Chicago',
    repMins: 9*60,
    prospectTz: null,
    prospectMins: null,
    prospectMilitary: false
  };

  // ===== UI update =====
  function render(){
    // Rep
    repTime.textContent = toLabel12(state.repMins);
    repRange.value = state.repMins;

    const hasProspect = !!state.prospectTz;
    milToggle.disabled = !hasProspect;
    prospectRange.disabled = !hasProspect;

    if (hasProspect){
      const conv = convert(state.repMins, state.repTz, state.prospectTz);
      state.prospectMins = conv.minutes;
      prospectTime.textContent = state.prospectMilitary ? toLabel24(state.prospectMins) : toLabel12(state.prospectMins);
      prospectRange.value = state.prospectMins;

      if (conv.dayOff !== 0){ badge.style.display='inline-block'; badge.textContent=(conv.dayOff>0?'+':'')+conv.dayOff+' day'; }
      else { badge.style.display='none'; }

      let d = (state.prospectMins - state.repMins)/60;
      d = Math.round(d*100)/100; if (d>12) d -= 24; if (d<-12) d += 24;
      diff.textContent = (d>0?'+':'') + d + ' hrs';
    } else {
      prospectTime.textContent = '--:--';
      badge.style.display='none';
      diff.textContent = '—';
    }
  }

  // ===== Prospect search =====
  function openProspectList(query){
    const s = query.trim().toLowerCase();
    const source = COUNTRY_ROWS.concat(ZONE_ROWS);
    const rows = s
      ? source.filter(r => r.label.toLowerCase().includes(s) || r.tz.toLowerCase().includes(s))
      : COUNTRY_ROWS; // default to country list

    prospectList.innerHTML = rows.slice(0,500)
      .map(r => `<button class="option" data-tz="${r.tz}">${r.label}</button>`).join('') ||
      `<div class="muted" style="padding:10px 14px">No matches.</div>`;
    prospectList.style.display='block';
  }
  function closeProspectList(){ prospectList.style.display='none'; }

  document.addEventListener('click', e => {
    if (!prospectList.contains(e.target) && e.target !== prospectInput) closeProspectList();
  });
  prospectInput.addEventListener('focus', () => openProspectList(prospectInput.value));
  prospectInput.addEventListener('input', () => openProspectList(prospectInput.value));
  prospectInput.addEventListener('keydown', e => {
    if (e.key === 'Enter'){
      const first = prospectList.querySelector('[data-tz]');
      if (first){ first.click(); e.preventDefault(); }
    } else if (e.key === 'Escape'){ closeProspectList(); }
  });
  prospectList.addEventListener('click', e => {
    const btn = e.target.closest('[data-tz]'); if (!btn) return;
    const tz = btn.getAttribute('data-tz');
    state.prospectTz = tz;
    prospectSelected.textContent = labelTZ(tz);
    prospectSelected.style.display='block'; // show only after selection
    prospectInput.value='';
    closeProspectList();
    render();
  });

  // ===== Events =====
  repSelect.addEventListener('change', e => { state.repTz = e.target.value; render(); });
  repRange.addEventListener('input', e => { state.repMins = +e.target.value; render(); });
  milToggle.addEventListener('click', () => {
    state.prospectMilitary = !state.prospectMilitary;
    milToggle.classList.toggle('active', state.prospectMilitary);
    milToggle.setAttribute('aria-pressed', String(state.prospectMilitary));
    render();
  });

  // ===== Init =====
  render();
})();
</script>
</body>
</html>
