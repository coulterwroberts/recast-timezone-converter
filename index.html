<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Time Zone Converter</title>
<style>
  :root{
    --bg:#f8fafc; 
    --card:#fff; 
    --border:#2563eb;       /* blue borders everywhere */
    --text:#0f172a; 
    --muted:#64748b;
    --orange:#f97316; 
    --blue:#2563eb; 
    --ring:#bae6fd; 
    --tick-gap:14px;
    --green:#065f46;
    --green-bg:#ecfdf5;
    --green-br:#a7f3d0;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans;
    background:linear-gradient(#fff,var(--bg));
    color:var(--text)
  }
  .container{
    max-width:1100px;
    margin:40px auto;
    padding:28px;
    background:#fff;
    border:6px solid var(--orange);
    border-radius:18px;
    box-shadow:0 8px 28px rgba(2,6,23,.08)
  }
  h1{margin:8px 0 18px;font-size:30px}

  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  @media(max-width:980px){.grid2{grid-template-columns:1fr}}

  .card{
    background:#fff;
    border:3px solid var(--border);
    border-radius:14px;
    padding:18px
  }
  .label{
    text-transform:uppercase;
    letter-spacing:.06em;
    color:#64748b;
    font-size:12px;
    margin-bottom:8px
  }
  .select,.input{
    border:2px solid var(--border);
    padding:10px 12px;
    border-radius:12px;
    background:#fff;
    width:100%;
    font-size:15px;
    height:44px
  }
  .input:focus,.select:focus{outline:3px solid var(--ring)}
  .time-row{display:flex;align-items:center;gap:12px;margin-top:4px}
  .time{font-size:28px;font-weight:800;white-space:nowrap;line-height:1}
  .badge{font-size:12px;border:2px solid #cbd5e1;border-radius:999px;padding:2px 8px;color:#334155;display:none}

  .btn{
    border:none;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer;
  }
  .btn-blue{background:#0b66ff;color:#fff}
  .btn-blue[aria-pressed="true"]{opacity:.9;box-shadow:inset 0 0 0 2px rgba(255,255,255,.5)}

  .range{
    -webkit-appearance:none;appearance:none;width:100%;height:10px;border-radius:8px;background:#e5e7eb;outline:none;position:relative;
    background-image:linear-gradient(var(--text),var(--text)),linear-gradient(var(--text),var(--text)),linear-gradient(var(--text),var(--text));
    background-size:2px 16px,2px 16px,2px 16px; 
    background-repeat:no-repeat;
    background-position:0% 50%,50% 50%,100% 50%; /* midnight, noon, midnight */
  }
  .range::-webkit-slider-runnable-track{height:10px;border-radius:8px;background:transparent}
  .range::-webkit-slider-thumb{
    -webkit-appearance:none;appearance:none;width:22px;height:22px;border-radius:50%;
    background:#0b66ff;border:2px solid #fff;margin-top:-6px;box-shadow:0 0 0 1px rgba(0,0,0,.2)
  }
  .range::-moz-range-track{height:10px;border-radius:8px;background:transparent}
  .range::-moz-range-progress{height:10px;background:#0b66ff;border-radius:8px}
  .range::-moz-range-thumb{width:22px;height:22px;border-radius:50%;background:#0b66ff;border:2px solid #fff}

  .tick-wrap{padding-inline:84px}
  .ticks{
    display:flex;justify-content:space-between;align-items:flex-start;font-size:12px;color:#64748b;
    margin-top:var(--tick-gap);line-height:1;white-space:nowrap
  }
  .ticks span{width:0;position:relative}
  .ticks span:first-child{transform:translateX(-10px)}
  .ticks span:nth-child(2){transform:translateX(0)}
  .ticks span:last-child{transform:translateX(-12px)} /* pull slightly inward on the right */

  .summary{
    margin-top:20px;border:3px solid var(--blue);border-radius:14px;padding:16px;background:#fff;text-align:center
  }
  .muted{color:var(--muted);font-size:15px;line-height:1.35}
  #diff.big{font-size:24px;font-weight:800;margin:2px 0 6px;color:var(--green)} /* green, always */
  .ov-title{font-weight:800;margin-top:12px}
  .ov-text{margin-top:6px;font-weight:600}
  .ov-chip{
    display:inline-block;margin-top:8px;padding:6px 10px;border-radius:10px;
    background:var(--green-bg);color:var(--green);border:1px solid var(--green-br);font-weight:700
  }
  .ov-chip b{color:var(--green)} /* make ↔ bold and green */

  .box{position:relative}
  .listbox{
    position:absolute;z-index:30;background:#fff;border:2px solid #cbd5e1;border-radius:10px;
    max-height:260px;overflow:auto;box-shadow:0 10px 24px rgba(2,6,23,.12);left:0;right:0
  }
  .option{padding:8px 12px;cursor:pointer}
  .option[aria-selected="true"], .option:hover{background:#eff6ff}

  #zoneRow{display:none;margin-top:10px}
</style>
</head>
<body>
  <div class="container">
    <h1>Time Zone Converter</h1>

    <div class="grid2">
      <!-- Rep (AM/PM always) -->
      <div class="card">
        <div class="label" style="color:var(--green);font-weight:800">Rep’s Timezone</div>
        <select id="rSelect" class="select">
          <option value="America/Los_Angeles">Pacific</option>
          <option value="America/Denver">Mountain</option>
          <option value="America/Chicago" selected>Central</option>
          <option value="America/New_York">Eastern</option>
        </select>

        <div class="time-row">
          <span id="rTime" class="time">--:--</span>
        </div>

        <div class="tick-wrap">
          <input id="rRange" class="range" type="range" min="0" max="1440" step="15"/>
          <div class="ticks" id="rTicks"><span>12 AM</span><span>12 PM</span><span>12 AM</span></div>
        </div>
      </div>

      <!-- Prospect (country + conditional zone picker) -->
      <div class="card">
        <div class="label" style="color:var(--green);font-weight:800">Prospect’s Timezone</div>

        <div class="box" id="countryBox">
          <input id="countryInput" class="input" placeholder="Input Country" autocomplete="off"
                 aria-autocomplete="list" aria-controls="countryList" />
          <div id="countryList" class="listbox" role="listbox" style="display:none"></div>
        </div>

        <!-- Appears only for multi-timezone countries (e.g., Canada) -->
        <div id="zoneRow">
          <div class="label" style="margin-top:8px">Choose time zone</div>
          <select id="zoneSelect" class="select"></select>
        </div>

        <div class="time-row">
          <span id="pTime" class="time">--:--</span>
          <span id="badge" class="badge">+1 day</span>
          <button id="milBtn" class="btn btn-blue" type="button" aria-pressed="false" style="margin-left:auto">Military time</button>
        </div>

        <div class="tick-wrap">
          <input id="pRange" class="range" type="range" min="0" max="1440" step="15"/>
          <div class="ticks" id="pTicks"><span>12 AM</span><span>12 PM</span><span>12 AM</span></div>
        </div>
      </div>
    </div>

    <!-- bottom summary -->
    <div class="summary">
      <div class="muted">Current difference</div>
      <div id="diff" class="big">—</div>
      <div class="ov-title">Overlapping business hours</div>
      <div id="ovMsg" class="ov-text">Select a country to see 9–5 overlap.</div>
      <div id="ovChip"></div>
    </div>
  </div>

<script>
(() => {
  /* Countries: either a single primary zone OR a list of labeled zones */
  const COUNTRY_ZONES = {
    "United States": [
      ["Eastern (America/New_York)","America/New_York"],
      ["Central (America/Chicago)","America/Chicago"],
      ["Mountain (America/Denver)","America/Denver"],
      ["Pacific (America/Los_Angeles)","America/Los_Angeles"],
      ["Alaska (America/Anchorage)","America/Anchorage"],
      ["Hawaii (Pacific/Honolulu)","Pacific/Honolulu"]
    ],
    "Canada": [
      ["Newfoundland (America/St_Johns)","America/St_Johns"],
      ["Atlantic (America/Halifax)","America/Halifax"],
      ["Eastern (America/Toronto)","America/Toronto"],
      ["Central (America/Winnipeg)","America/Winnipeg"],
      ["Mountain (America/Edmonton)","America/Edmonton"],
      ["Pacific (America/Vancouver)","America/Vancouver"]
    ],
    "Australia": [
      ["Western (Australia/Perth)","Australia/Perth"],
      ["Northern Territory (Australia/Darwin)","Australia/Darwin"],
      ["Queensland (Australia/Brisbane)","Australia/Brisbane"],
      ["South Australia (Australia/Adelaide)","Australia/Adelaide"],
      ["New South Wales / ACT (Australia/Sydney)","Australia/Sydney"],
      ["Victoria (Australia/Melbourne)","Australia/Melbourne"],
      ["Tasmania (Australia/Hobart)","Australia/Hobart"]
    ],
    "Brazil": [
      ["Brasília (America/Sao_Paulo)","America/Sao_Paulo"],
      ["Amazon (America/Manaus)","America/Manaus"],
      ["Acre (America/Rio_Branco)","America/Rio_Branco"],
      ["Mato Grosso (America/Cuiaba)","America/Cuiaba"]
    ],
    "Mexico": [
      ["Eastern (America/Cancun)","America/Cancun"],
      ["Central (America/Mexico_City)","America/Mexico_City"],
      ["Mountain (America/Chihuahua)","America/Chihuahua"],
      ["Pacific (America/Tijuana)","America/Tijuana"]
    ],

    /* Single-zone countries */
    "United Kingdom":"Europe/London","Ireland":"Europe/Dublin",
    "Italy":"Europe/Rome","Romania":"Europe/Bucharest","Germany":"Europe/Berlin","France":"Europe/Paris","Spain":"Europe/Madrid",
    "Netherlands":"Europe/Amsterdam","Sweden":"Europe/Stockholm","Norway":"Europe/Oslo","Denmark":"Europe/Copenhagen",
    "Switzerland":"Europe/Zurich","Poland":"Europe/Warsaw","Portugal":"Europe/Lisbon","Greece":"Europe/Athens","Turkey":"Europe/Istanbul",
    "Israel":"Asia/Jerusalem","United Arab Emirates":"Asia/Dubai","Saudi Arabia":"Asia/Riyadh","Egypt":"Africa/Cairo",
    "India":"Asia/Kolkata","Pakistan":"Asia/Karachi","Bangladesh":"Asia/Dhaka","China":"Asia/Shanghai","Hong Kong":"Asia/Hong_Kong",
    "Taiwan":"Asia/Taipei","Japan":"Asia/Tokyo","South Korea":"Asia/Seoul","Singapore":"Asia/Singapore","Malaysia":"Asia/Kuala_Lumpur",
    "Thailand":"Asia/Bangkok","Vietnam":"Asia/Ho_Chi_Minh","Indonesia":"Asia/Jakarta","Philippines":"Asia/Manila",
    "New Zealand":"Pacific/Auckland",
    "Argentina":"America/Argentina/Buenos_Aires","Chile":"America/Santiago","Colombia":"America/Bogota",
    "Peru":"America/Lima",
    "South Africa":"Africa/Johannesburg","Nigeria":"Africa/Lagos","Kenya":"Africa/Nairobi","Ghana":"Africa/Accra"
  };
  const COUNTRIES = Object.keys(COUNTRY_ZONES).sort();

  // DST-safe helpers
  const BASE = new Date();
  const pad = n => (n<10?'0':'')+n;
  const clamp = n => ((n%1440)+1440)%1440;
  function parts(d, tz){
    const f = new Intl.DateTimeFormat('en-US',{
      timeZone:tz, year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false
    });
    const m={}; f.formatToParts(d).forEach(p=>m[p.type]=p.value);
    return {year:+m.year,month:+m.month,day:+m.day,hour:+m.hour,minute:+m.minute,second:+m.second};
  }
  function offsetMin(tz,d){
    const p=parts(d,tz); const asUTC=Date.UTC(p.year,p.month-1,p.day,p.hour,p.minute,p.second);
    return (asUTC - d.getTime())/60000;
  }
  function localToUTC({year,month,day,hour,minute},tz){
    let guess = Date.UTC(year,month-1,day,hour,minute,0);
    let o = offsetMin(tz,new Date(guess));
    let utc = guess - o*60000;
    o = offsetMin(tz,new Date(utc));
    return new Date(Date.UTC(year,month-1,day,hour,minute,0) - o*60000);
  }
  function convert(mins, fromTz, toTz){
    const fp=parts(BASE,fromTz);
    const utc=localToUTC({year:fp.year,month:fp.month,day:fp.day,hour:Math.floor(mins/60),minute:mins%60},fromTz);
    const tp=parts(utc,toTz);
    const fromMidUTC=localToUTC({year:fp.year,month:fp.month,day:fp.day,hour:0,minute:0},fromTz);
    const toAtFromMid=parts(fromMidUTC,toTz);
    const dayOff=Math.round((Date.UTC(tp.year,tp.month-1,tp.day)-Date.UTC(toAtFromMid.year,toAtFromMid.month-1,toAtFromMid.day))/(24*3600*1000));
    return {minutes:clamp(tp.hour*60+tp.minute), dayOff};
  }
  const fmt12 = m => { const h=Math.floor(m/60),mm=m%60,ap=h>=12?'PM':'AM',h12=((h+11)%12)+1; return h12+':'+pad(mm)+' '+ap; };
  const fmt24 = m => { const h=Math.floor(m/60),mm=m%60; return pad(h)+':'+pad(mm); };

  // Elements
  const rSelect = document.getElementById('rSelect');
  const rRange  = document.getElementById('rRange');
  const rTime   = document.getElementById('rTime');

  const countryBox    = document.getElementById('countryBox');
  const countryInput  = document.getElementById('countryInput');
  const countryList   = document.getElementById('countryList');
  const zoneRow       = document.getElementById('zoneRow');
  const zoneSelect    = document.getElementById('zoneSelect');

  const pRange  = document.getElementById('pRange');
  const pTime   = document.getElementById('pTime');
  const badge   = document.getElementById('badge');
  const milBtn  = document.getElementById('milBtn');

  const diffEl  = document.getElementById('diff');
  const ovMsg   = document.getElementById('ovMsg');
  const ovChip  = document.getElementById('ovChip');

  // State
  let state = {
    repTz: rSelect.value,
    repMins: 12*60,
    pCountry: null,
    pTz: null,
    pLabel: null,
    p24: false        // Prospect military-time toggle
  };

  // Country dropdown (type-to-filter) + outside-click close
  function fuzzyScore(q, s){ q=q.toLowerCase(); s=s.toLowerCase(); let i=0,score=0;
    for (let c of s){ if (i<q.length && c===q[i]){ score+=2; i++; } else score+=(q.includes(c)?1:0); }
    if (s.startsWith(q)) score+=3; return (i===q.length)?score:-1;
  }
  function renderCountryList(q){
    const items = q
      ? COUNTRIES.map(c=>({c,score:fuzzyScore(q,c)})).filter(x=>x.score>=0).sort((a,b)=>b.score-a.score).map(x=>x.c)
      : COUNTRIES;
    countryList.innerHTML = items.map((c,i)=>`<div class="option" role="option" data-value="${c}" ${i===0?'aria-selected="true"':''}>${c}</div>`).join('');
    countryList.style.display = items.length ? 'block':'none';
  }
  let activeIdx=0;
  function moveActive(d){ const opts=[...countryList.querySelectorAll('.option')]; if(!opts.length)return;
    opts[activeIdx]?.removeAttribute('aria-selected'); activeIdx=(activeIdx+d+opts.length)%opts.length;
    opts[activeIdx].setAttribute('aria-selected','true'); opts[activeIdx].scrollIntoView({block:'nearest'}); }
  function chooseActive(){ const o=countryList.querySelector('.option[aria-selected="true"]'); if(o) chooseCountry(o.dataset.value); }

  countryInput.addEventListener('focus',()=>renderCountryList(countryInput.value.trim()));
  countryInput.addEventListener('input',e=>{activeIdx=0;renderCountryList(e.target.value.trim());});
  countryInput.addEventListener('keydown',e=>{
    if(e.key==='ArrowDown'){e.preventDefault();moveActive(1);} 
    else if(e.key==='ArrowUp'){e.preventDefault();moveActive(-1);}
    else if(e.key==='Enter'){e.preventDefault();chooseActive();}
    else if(e.key==='Escape'){countryList.style.display='none';}
  });
  countryList.addEventListener('click',e=>{
    const el=e.target.closest('.option'); 
    if(el) chooseCountry(el.dataset.value);
  });
  document.addEventListener('click', (e)=>{
    if(!countryBox.contains(e.target)) countryList.style.display='none';
  });

  function chooseCountry(name){
    countryInput.value = name;
    countryList.style.display = 'none';
    state.pCountry = name;
    const mapping = COUNTRY_ZONES[name];

    if (Array.isArray(mapping)){
      zoneRow.style.display = 'block';
      zoneSelect.innerHTML = mapping.map(([label, tz]) => `<option value="${tz}">${label}</option>`).join('');
      zoneSelect.value = mapping[0][1];
      state.pTz = zoneSelect.value;
      state.pLabel = `${name} — ${mapping[0][0]}`;
      zoneSelect.onchange = () => {
        const opt = zoneSelect.options[zoneSelect.selectedIndex];
        state.pTz = opt.value;
        state.pLabel = `${name} — ${opt.textContent}`;
        updateOverlap(); render();
      };
    } else {
      zoneRow.style.display = 'none';
      state.pTz = mapping || null;
      state.pLabel = name;
    }
    updateOverlap(); render();
  }

  // Overlap (strict: cap at 5:00 PM local for both)
  function computeSuggestedWindowStrict(){
    if(!state.pTz) return null;
    const rs = 9*60, re = 17*60; // rep 9–5
    const ps = 9*60, pe = 17*60; // prospect 9–5

    let start=null, end=null;
    // iterate 15-min blocks that *fully* fit in both windows
    for(let m=rs; m<=re-15; m+=15){
      const pStart = convert(m,   state.repTz, state.pTz).minutes;
      const pEnd   = convert(m+15,state.repTz, state.pTz).minutes;
      const blockOK = (m   >= rs && m+15 <= re) && (pStart >= ps && pEnd <= pe);
      if(blockOK){
        if(start===null) start=m;
        end=m+15; // always end at block end, but never past 5:00
      }else if(start!==null){
        break;
      }
    }
    if(start===null) return null;
    return {start, end}; // end already ≤ 17:00 on both sides
  }

  function updateOverlap(){
    ovChip.innerHTML='';
    if(!state.pTz){ 
      ovMsg.textContent='Select a country to see 9–5 overlap.'; 
      return; 
    }
    const win = computeSuggestedWindowStrict();
    if(!win){
      ovMsg.textContent='No overlap between 9–5 windows.';
      return;
    }
    ovMsg.textContent='Rep 9–5 vs Prospect 9–5:';
    const repStart = fmt12(win.start);
    const repEnd   = fmt12(win.end);
    const pStart   = formatProspect(win.start);
    const pEnd     = formatProspect(win.end);
    ovChip.innerHTML = `<span class="ov-chip">Suggested: Rep ${repStart}–${repEnd} <b>↔</b> Prospect ${pStart}–${pEnd}</span>`;
  }

  // Format helpers (prospect can be 24h)
  function formatProspect(m){ 
    const mm = convert(m, state.repTz, state.pTz).minutes;
    return state.p24 ? fmt24(mm) : fmt12(mm);
  }

  // Render / two-way binding between sliders
  function render(){
    // Rep always shows its own minutes
    rRange.value = state.repMins; 
    rTime.textContent = fmt12(state.repMins);

    const repName = rSelect.options[rSelect.selectedIndex].textContent;
    const prospectName = state.pLabel || 'Prospect';

    if(state.pTz){
      // Prospect slider thumb shows *prospect local* time for the same moment
      const conv=convert(state.repMins,state.repTz,state.pTz);
      state.pMins = conv.minutes;
      pRange.value = state.pMins;                 // <— key change: reflect local prospect time
      pTime.textContent = formatProspect(state.repMins);
      badge.style.display = conv.dayOff!==0 ? 'inline-block':'none';
      if(conv.dayOff!==0) badge.textContent=(conv.dayOff>0?'+':'')+conv.dayOff+' day';

      // hours difference (normalized)
      let d=(state.pMins-state.repMins)/60; 
      d=Math.round(d*100)/100; 
      if(d>12)d-=24; 
      if(d<-12)d+=24;
      const aheadBehind = d===0 ? 'the same as' : (d>0 ? 'ahead of' : 'behind');
      const absH = Math.abs(d);
      diffEl.textContent = `${prospectName} is ${absH} ${absH===1?'hour':'hours'} ${aheadBehind} ${repName}.`;
    }else{
      pTime.textContent='--:--'; 
      badge.style.display='none';
      pRange.value = state.repMins; // no country yet—just mirror position
      diffEl.textContent='—';
    }
    requestAnimationFrame(guardTickEdges);
  }

  // Keep tick labels away from edges
  function guardTickEdges(){
    const SAFE=16;
    document.querySelectorAll('.tick-wrap').forEach(wrap=>{
      const spans=wrap.querySelectorAll('.ticks span'); spans.forEach(s=>s.style.transform='');
      const wr=wrap.getBoundingClientRect();
      spans.forEach(span=>{
        const r=span.getBoundingClientRect(); let dx=0;
        if(r.left<wr.left+SAFE) dx=(wr.left+SAFE)-r.left;
        if(r.right>wr.right-SAFE) dx=-(r.right-(wr.right-SAFE));
        if(dx) span.style.transform=`translateX(${dx}px)`;
      });
    });
  }
  window.addEventListener('resize',()=>requestAnimationFrame(guardTickEdges));

  // Events
  rSelect.addEventListener('change',e=>{state.repTz=e.target.value; updateOverlap(); render();});
  rRange.addEventListener('input',e=>{state.repMins=+e.target.value; render(); updateOverlap();});

  // Prospect slider as input: convert *back* to rep time so both stay linked
  pRange.addEventListener('input',e=>{
    const pVal = +e.target.value;
    if(state.pTz){
      const back = convert(pVal, state.pTz, state.repTz).minutes; // prospect local -> rep local
      state.repMins = back;
    }else{
      state.repMins = pVal; // no country picked yet, just mirror
    }
    render(); updateOverlap();
  });

  milBtn.addEventListener('click',()=>{
    state.p24 = !state.p24;
    milBtn.setAttribute('aria-pressed', String(state.p24));
    render(); updateOverlap();
  });

  // Defaults: no country pre-selected; sliders start at 12:00 PM
  rRange.value = pRange.value = state.repMins;
  render();
})();
</script>
</body>
</html>
